package mocks

import (
	"bytes"
	"encoding/json"
	"fmt"
	"github.com/stretchr/testify/assert"
	"io"
	"log"
	"net/http"
	parser_discogs "producer/internal/parsers/parser-discogs/discogs-functions"
	lastfm_structs2 "producer/internal/parsers/parser-lastfm/lastfm-structs"
	"testing"
)

func TestTrackAmount(t *testing.T) {
	url := "http://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=acf27b3481a7364188d79e3ad60789fb&artist=Deep%20Purple&album=Anthem&format=json"
	jsonTest := "{\"album\":{\"artist\":\"Deep Purple\",\"mbid\":\"0f90816d-1d70-4a38-8de6-ac982b3e1e99\",\"tags\":{\"tag\":[{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/hard+rock\",\"name\":\"hard rock\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/classic+rock\",\"name\":\"classic rock\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/rock\",\"name\":\"rock\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/progressive+rock\",\"name\":\"progressive rock\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/heavy+metal\",\"name\":\"heavy metal\"}]},\"name\":\"Anthem\",\"image\":[{\"size\":\"small\",\"#text\":\"\"},{\"size\":\"medium\",\"#text\":\"\"},{\"size\":\"large\",\"#text\":\"\"},{\"size\":\"extralarge\",\"#text\":\"\"},{\"size\":\"mega\",\"#text\":\"\"},{\"size\":\"\",\"#text\":\"\"}],\"tracks\":{\"track\":[{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":null,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Deep+Purple\\/Anthem\\/Anthem+(Part+1)\",\"name\":\"Anthem (Part 1)\",\"@attr\":{\"rank\":1},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Deep+Purple\",\"name\":\"Deep Purple\",\"mbid\":\"79491354-3d83-40e3-9d8e-7592d58d790a\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":null,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Deep+Purple\\/Anthem\\/Anthem+(Part+2)\",\"name\":\"Anthem (Part 2)\",\"@attr\":{\"rank\":2},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Deep+Purple\",\"name\":\"Deep Purple\",\"mbid\":\"79491354-3d83-40e3-9d8e-7592d58d790a\"}}]},\"listeners\":\"12\",\"playcount\":\"380\",\"url\":\"https:\\/\\/www.last.fm\\/music\\/Deep+Purple\\/Anthem\"}}"

	r := io.NopCloser(bytes.NewReader([]byte(jsonTest)))
	GetDoFunc = func(*http.Request) (*http.Response, error) {
		return &http.Response{
			StatusCode: 200,
			Body:       r,
		}, nil
	}

	resp, err := parser_discogs.Get(url)
	if err != nil {
		fmt.Println("Something went wrong with connecting to lastfm")
		log.Fatal(err)
	}

	data, err := io.ReadAll(resp.Body)
	if err != nil {
		fmt.Println("Something went wrong with reading data...")
		log.Fatal(err)
	}
	var album lastfm_structs2.LastFmAlbumJson
	json.Unmarshal(data, &album)

	assert.NotNil(t, resp)
	assert.Nil(t, err)
	fmt.Println(len(album.Album.Tracks.Track))
}

func TestReadArtist(t *testing.T) {
	url := "http://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist=Cher&api_key=acf27b3481a7364188d79e3ad60789fb&format=json"
	jsonTest := "{\"artist\":{\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\",\"url\":\"https://www.last.fm/music/Cher\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"extralarge\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"mega\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"\"}],\"streamable\":\"0\",\"ontour\":\"0\",\"stats\":{\"listeners\":\"1430900\",\"playcount\":\"22590100\"},\"similar\":{\"artist\":[{\"name\":\"Madonna\",\"url\":\"https://www.last.fm/music/Madonna\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"extralarge\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"mega\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"\"}]},{\"name\":\"Kylie Minogue\",\"url\":\"https://www.last.fm/music/Kylie+Minogue\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"extralarge\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"mega\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"\"}]},{\"name\":\"Sonny & Cher\",\"url\":\"https://www.last.fm/music/Sonny+&+Cher\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"extralarge\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"mega\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"\"}]},{\"name\":\"Barbra Streisand\",\"url\":\"https://www.last.fm/music/Barbra+Streisand\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"extralarge\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"mega\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"\"}]},{\"name\":\"Tina Turner\",\"url\":\"https://www.last.fm/music/Tina+Turner\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"extralarge\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"mega\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png\",\"size\":\"\"}]}]},\"tags\":{\"tag\":[{\"name\":\"pop\",\"url\":\"https://www.last.fm/tag/pop\"},{\"name\":\"female vocalists\",\"url\":\"https://www.last.fm/tag/female+vocalists\"},{\"name\":\"80s\",\"url\":\"https://www.last.fm/tag/80s\"},{\"name\":\"dance\",\"url\":\"https://www.last.fm/tag/dance\"},{\"name\":\"rock\",\"url\":\"https://www.last.fm/tag/rock\"}]},\"bio\":{\"links\":{\"link\":{\"#text\":\"\",\"rel\":\"original\",\"href\":\"https://last.fm/music/Cher/+wiki\"}},\"published\":\"17 Feb 2006, 22:09\",\"summary\":\"Cher (born Cherilyn Sarkisian; May 20, 1946) is an American singer, actress and television personality. Often referred to by the media as the \\\"Goddess of Pop\\\", she has been described as embodying female autonomy in a male-dominated industry. Cher is known for her distinctive contralto singing voice and for having worked in numerous areas of entertainment, as well as adopting a variety of styles and appearances throughout her six-decade-long career. <a href=\\\"https://www.last.fm/music/Cher\\\">Read more on Last.fm</a>\",\"content\":\"Cher (born Cherilyn Sarkisian; May 20, 1946) is an American singer, actress and television personality. Often referred to by the media as the \\\"Goddess of Pop\\\", she has been described as embodying female autonomy in a male-dominated industry. Cher is known for her distinctive contralto singing voice and for having worked in numerous areas of entertainment, as well as adopting a variety of styles and appearances throughout her six-decade-long career.\\n\\nCher gained popularity in 1965 as one-half of the folk rock husband-wife duo Sonny & Cher after their song \\\"I Got You Babe\\\" peaked at number one on the US and UK charts. Together they sold 40 million records worldwide. Her solo career was established during the same time, with the top-ten singles \\\"Bang Bang (My Baby Shot Me Down)\\\" and \\\"You Better Sit Down Kids\\\". She became a television personality in the 1970s with her CBS shows; first The Sonny & Cher Comedy Hour, watched by over 30 million viewers weekly during its three-year run, and then the namesake Cher. She emerged as a fashion trendsetter by wearing elaborate outfits on her television shows.\\n\\nWhile working on television, Cher released the US Billboard Hot 100 number-one singles \\\"Gypsys, Tramps & Thieves\\\", \\\"Half-Breed\\\", and \\\"Dark Lady\\\", becoming the female artist with the most number-one singles in United States history at the time. After her divorce from Sonny Bono in 1975, she released the disco album Take Me Home (1979) and earned $300,000 a week for her 1979–1982 concert residency in Las Vegas.\\n\\nIn 1982, Cher made her Broadway debut in the play Come Back to the 5 & Dime, Jimmy Dean, Jimmy Dean and starred in its film adaptation. She subsequently garnered critical acclaim for her performances in films such as Silkwood (1983), Mask (1985), The Witches of Eastwick (1987), and Moonstruck (1987), the last of which won her the Academy Award for Best Actress. She then revived her music career by recording the rock-inflected albums Cher (1987), Heart of Stone (1989), and Love Hurts (1991), all of which yielded successful singles such as \\\"I Found Someone\\\", \\\"If I Could Turn Back Time\\\", and \\\"Love and Understanding\\\". Cher contributed to the soundtrack for her next film, Mermaids (1990), which spawned the UK number-one single \\\"The Shoop Shoop Song (It's in His Kiss)\\\". She made her directorial debut with a segment in the abortion-themed anthology If These Walls Could Talk (1996).\\n\\nCher reached a new commercial peak in 1998 with the dance-pop album Believe, whose title track topped the Billboard Year-End Hot 100 singles of 1999 and became the biggest-selling single of all time by a female artist in the UK. It features pioneering use of Auto-Tune to distort her vocals, known as the \\\"Cher effect\\\". Her 2002–2005 Living Proof: The Farewell Tour became one of the highest-grossing concert tours of all time, earning $250 million. In 2008, she signed a $60 million deal to headline the Colosseum at Caesars Palace in Las Vegas for three years. During the 2010s, she landed starring roles in the films Burlesque (2010) and Mamma Mia! Here We Go Again (2018) and released studio albums Closer to the Truth (2013) and Dancing Queen (2018), both of which debuted at number three on the Billboard 200.\\n\\nHaving sold 100 million records, Cher is one of the world's best-selling music artists. Her achievements include a Grammy Award, an Emmy Award, an Academy Award, three Golden Globe Awards, the Billboard Icon Award, and awards from the Kennedy Center Honors and the Council of Fashion Designers of America. She is the only artist to date to have a number-one single on a Billboard chart in six consecutive decades, from the 1960s to the 2010s. Aside from music and acting, she is noted for her political views, social media presence, philanthropic endeavors, and social activism, including LGBT rights and HIV/AIDS prevention.\\n\\nOfficial Website: https://cher.com\\nOfficial Fan Club: https://www.cherfanclub.com\\nYouTube Channel: https://youtube.com/cher <a href=\\\"https://www.last.fm/music/Cher\\\">Read more on Last.fm</a>. User-contributed text is available under the Creative Commons By-SA License; additional terms may apply.\"}}}"

	r := io.NopCloser(bytes.NewReader([]byte(jsonTest)))
	GetDoFunc = func(*http.Request) (*http.Response, error) {
		return &http.Response{
			StatusCode: 200,
			Body:       r,
		}, nil
	}

	resp, err := parser_discogs.Get(url)
	if err != nil {
		fmt.Println("Something went wrong with connecting to lastfm")
		log.Fatal(err)
	}

	data, err := io.ReadAll(resp.Body)
	if err != nil {
		fmt.Println("Something went wrong with reading data...")
		log.Fatal(err)
	}
	var artist lastfm_structs2.LastFmArtistJson
	json.Unmarshal(data, &artist)

	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, "bfcc6d75-a6a5-4bc6-8282-47aec8531818", artist.Artist.Mbid)
	assert.EqualValues(t, "Cher", artist.Artist.Name)
}

func TestReadAlbum(t *testing.T) {
	url := "http://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=acf27b3481a7364188d79e3ad60789fb&artist=Cher&album=Believe&format=json"
	jsonTest := "{\"album\":{\"artist\":\"Cher\",\"mbid\":\"03c91c40-49a6-44a7-90e7-a700edf97a62\",\"tags\":{\"tag\":[{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/pop\",\"name\":\"pop\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/dance\",\"name\":\"dance\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/90s\",\"name\":\"90s\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/1998\",\"name\":\"1998\"},{\"url\":\"https:\\/\\/www.last.fm\\/tag\\/cher\",\"name\":\"cher\"}]},\"playcount\":\"4340266\",\"image\":[{\"size\":\"small\",\"#text\":\"https:\\/\\/lastfm.freetls.fastly.net\\/i\\/u\\/34s\\/3b54885952161aaea4ce2965b2db1638.png\"},{\"size\":\"medium\",\"#text\":\"https:\\/\\/lastfm.freetls.fastly.net\\/i\\/u\\/64s\\/3b54885952161aaea4ce2965b2db1638.png\"},{\"size\":\"large\",\"#text\":\"https:\\/\\/lastfm.freetls.fastly.net\\/i\\/u\\/174s\\/3b54885952161aaea4ce2965b2db1638.png\"},{\"size\":\"extralarge\",\"#text\":\"https:\\/\\/lastfm.freetls.fastly.net\\/i\\/u\\/300x300\\/3b54885952161aaea4ce2965b2db1638.png\"},{\"size\":\"mega\",\"#text\":\"https:\\/\\/lastfm.freetls.fastly.net\\/i\\/u\\/300x300\\/3b54885952161aaea4ce2965b2db1638.png\"},{\"size\":\"\",\"#text\":\"https:\\/\\/lastfm.freetls.fastly.net\\/i\\/u\\/300x300\\/3b54885952161aaea4ce2965b2db1638.png\"}],\"tracks\":{\"track\":[{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":238,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Believe\",\"name\":\"Believe\",\"@attr\":{\"rank\":1},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":228,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/The+Power\",\"name\":\"The Power\",\"@attr\":{\"rank\":2},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":272,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Runaway\",\"name\":\"Runaway\",\"@attr\":{\"rank\":3},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":238,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/All+or+Nothing\",\"name\":\"All or Nothing\",\"@attr\":{\"rank\":4},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":181,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Strong+Enough\",\"name\":\"Strong Enough\",\"@attr\":{\"rank\":5},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":null,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Dov%27e+L%27amore\",\"name\":\"Dov'e L'amore\",\"@attr\":{\"rank\":6},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":272,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Takin%27+Back+My+Heart\",\"name\":\"Takin' Back My Heart\",\"@attr\":{\"rank\":7},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":304,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Taxi+Taxi\",\"name\":\"Taxi Taxi\",\"@attr\":{\"rank\":8},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":271,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/Love+Is+the+Groove\",\"name\":\"Love Is the Groove\",\"@attr\":{\"rank\":9},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}},{\"streamable\":{\"fulltrack\":\"0\",\"#text\":\"0\"},\"duration\":233,\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\/We+All+Sleep+Alone\",\"name\":\"We All Sleep Alone\",\"@attr\":{\"rank\":10},\"artist\":{\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\",\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\"}}]},\"url\":\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\",\"name\":\"Believe\",\"listeners\":\"588460\",\"wiki\":{\"published\":\"03 Mar 2010, 16:48\",\"summary\":\"Believe is the twenty-third studio album by American singer-actress Cher, released on November 10, 1998 by Warner Bros. Records. The RIAA certified it Quadruple Platinum on December 23, 1999, recognizing four million shipments in the United States; Worldwide, the album has sold more than 20 million copies, making it the biggest-selling album of her career. In 1999 the album received three Grammy Awards nominations including \\\"Record of the Year\\\", \\\"Best Pop Album\\\" and winning \\\"Best Dance Recording\\\" for the single \\\"Believe\\\". It was released by Warner Bros. Records at the end of 1998. The album was executive produced by Rob <a href=\\\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\\">Read more on Last.fm<\\/a>.\",\"content\":\"Believe is the twenty-third studio album by American  singer-actress Cher, released on November 10, 1998 by Warner Bros. Records. The RIAA certified it Quadruple Platinum on December 23, 1999, recognizing four million shipments in the United States; Worldwide, the album has sold more than 20 million copies, making it the biggest-selling album of her career. In 1999 the album received three Grammy Awards nominations including \\\"Record of the Year\\\", \\\"Best Pop Album\\\" and winning \\\"Best Dance Recording\\\" for the single \\\"Believe\\\".\\n\\nIt was released by Warner Bros. Records at the end of 1998. The album was executive produced by Rob Dickens. Upon its debut, critical reception was generally positive. Believe became Cher's most commercially-successful release, reached number one and Top 10 all over the world. In the United States, the album was released on November 10, 1998, and reached number four on the Billboard 200 chart, where it was certified four times platinum.\\n\\nThe album featured a change in Cher's music; in addition, Believe presented a vocally stronger Cher and a massive use of vocoder and Auto-Tune. In 1999, the album received 3 Grammy Awards nominations for \\\"Record of the Year\\\", \\\"Best Pop Album\\\" and winning \\\"Best Dance Recording\\\". Throughout 1999 and into 2000 Cher was nominated and winning many awards for the album including a Billboard Music Award for \\\"Female Vocalist of the Year\\\", Lifelong Contribution Awards and a Star on the Walk of Fame shared with former Sonny Bono. The boost in Cher's popularity led to a very successful Do You Believe? Tour.\\n\\nThe album was dedicated to Sonny Bono, Cher's former husband who died earlier that year from a skiing accident.\\n\\nCher also recorded a cover version of \\\"Love Is in the Air\\\" during early sessions for this album. Although never officially released, the song has leaked on file sharing networks.\\n\\nSingles\\n\\n\\n\\\"Believe\\\"\\n\\\"Strong Enough\\\"\\n\\\"All or Nothing\\\"\\n\\\"Dov'è L'Amore\\\" <a href=\\\"https:\\/\\/www.last.fm\\/music\\/Cher\\/Believe\\\">Read more on Last.fm<\\/a>. User-contributed text is available under the Creative Commons By-SA License; additional terms may apply.\"}}}"

	r := io.NopCloser(bytes.NewReader([]byte(jsonTest)))
	GetDoFunc = func(*http.Request) (*http.Response, error) {
		return &http.Response{
			StatusCode: 200,
			Body:       r,
		}, nil
	}

	resp, err := parser_discogs.Get(url)
	if err != nil {
		fmt.Println("Something went wrong with connecting to lastfm")
		log.Fatal(err)
	}

	data, err := io.ReadAll(resp.Body)
	if err != nil {
		fmt.Println("Something went wrong with reading data...")
		log.Fatal(err)
	}
	var album lastfm_structs2.LastFmAlbumJson
	json.Unmarshal(data, &album)

	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, "03c91c40-49a6-44a7-90e7-a700edf97a62", album.Album.Mbid)
	assert.EqualValues(t, "Believe", album.Album.Name)
}

func TestReadTrack(t *testing.T) {
	url := "http://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=acf27b3481a7364188d79e3ad60789fb&artist=cher&track=believe&format=json"
	jsonTest := "{\"track\":{\"name\":\"Believe\",\"mbid\":\"32ca187e-ee25-4f18-b7d0-3b6713f24635\",\"url\":\"https://www.last.fm/music/Cher/_/Believe\",\"duration\":\"238000\",\"streamable\":{\"#text\":\"0\",\"fulltrack\":\"0\"},\"listeners\":\"667470\",\"playcount\":\"3696956\",\"artist\":{\"name\":\"Cher\",\"mbid\":\"bfcc6d75-a6a5-4bc6-8282-47aec8531818\",\"url\":\"https://www.last.fm/music/Cher\"},\"album\":{\"artist\":\"Cher\",\"title\":\"Believe\",\"mbid\":\"63b3a8ca-26f2-4e2b-b867-647a6ec2bebd\",\"url\":\"https://www.last.fm/music/Cher/Believe\",\"image\":[{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/34s/3b54885952161aaea4ce2965b2db1638.png\",\"size\":\"small\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/64s/3b54885952161aaea4ce2965b2db1638.png\",\"size\":\"medium\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/174s/3b54885952161aaea4ce2965b2db1638.png\",\"size\":\"large\"},{\"#text\":\"https://lastfm.freetls.fastly.net/i/u/300x300/3b54885952161aaea4ce2965b2db1638.png\",\"size\":\"extralarge\"}],\"@attr\":{\"position\":\"1\"}},\"toptags\":{\"tag\":[{\"name\":\"pop\",\"url\":\"https://www.last.fm/tag/pop\"},{\"name\":\"dance\",\"url\":\"https://www.last.fm/tag/dance\"},{\"name\":\"90s\",\"url\":\"https://www.last.fm/tag/90s\"},{\"name\":\"cher\",\"url\":\"https://www.last.fm/tag/cher\"},{\"name\":\"female vocalists\",\"url\":\"https://www.last.fm/tag/female+vocalists\"}]},\"wiki\":{\"published\":\"27 Jul 2008, 15:44\",\"summary\":\"\\\"Believe\\\" is a Grammy Award winning global number one, Multi-Platinum Dance Song which served as the world-wide lead single for American singer Cher's twenty-third studio album Believe. It is noted for its use of a peculiar sound effect on the singer's vocals, which is referred to as the Cher effect today.\\n\\n\\\"Believe\\\" was written by a number of writers including Paul Barry, Matt Gray, Brian Higgins, Stuart McLellan, Timothy Powell, and Steven Torch. <a href=\\\"http://www.last.fm/music/Cher/_/Believe\\\">Read more on Last.fm</a>.\",\"content\":\"\\\"Believe\\\" is a Grammy Award winning global number one, Multi-Platinum Dance Song which served as the world-wide lead single for American singer Cher's twenty-third studio album Believe. It is noted for its use of a peculiar sound effect on the singer's vocals, which is referred to as the Cher effect today.\\n\\n\\\"Believe\\\" was written by a number of writers including Paul Barry, Matt Gray, Brian Higgins, Stuart McLellan, Timothy Powell, and Steven Torch. The song, released and recorded in 1998, peaked at number one in 23 countries worldwide .In the second week of March, 1999, it reached number one in the Billboard Hot 100, making Cher the oldest female artist (at the age of 52) to perform this feat. It also was ranked as the number-one song of 1999 by Billboard, and became the biggest single in her entire career. \\\"Believe\\\" also spent seven weeks at number one] in the UK singles chart and is still the best selling single by a female artist in the UK. \\n\\n\\nIn March 2007, the United World Chart ranked \\\"Believe\\\" as the sixteenth most successful song in music history. The same chart lists \\\"Believe\\\" as third most successful song released by a solo female musician behind Whitney Houston's \\\"I Will Always Love You\\\" and Celine Dion's My Heart Will Go On; [5], the biggest selling single ever for Warner Bros. Records and the biggest selling dance song ever having sold over 10 million copies worldwide. It was also the song with most weeks in the top ten, it stayed in the top ten for 28 weeks.\\n\\nThe success of the song not only expanded through each country's singles chart, but also most country's dance charts. In the United States \\\"Believe\\\" spent 23 weeks on the U.S. Hot Dance Club Play chart and 22 weeks on the European Hot Dance Charts. \\\"Believe\\\" also set a record in 1999 after spending 21 weeks in the top spot of the Billboard Hot Dance Singles Sales chart, it was still in the top ten even one year after its entry on the chart. \\n\\n\\\"Believe\\\" was given the featured closing number spot for over 100 performances on Cher's 1999-2000 Do You Believe? Tour and then again the closing spot for over 300 performances on Cher's epic 2002-2005 Living Proof: The Farewell Tour. The song ranked #74 on VH1's 100 Greatest Songs of the 90s.\\n\\nAn interesting note about the recording of the song revolved around the highly-recognizable Auto-tune effect (\\\"Cher effect\\\") utilized in the verses and chorus. Producer Mark Taylor added the effect to Cher's vocal simply as a lark, and in interviews at the time, he claimed to be testing out his recently purchased the 'DigiTech Talker'. However, it later emerged that the effect was not created by a vocoder, but by utilizing extreme (and then unheard) settings on auto-tune.When Cher heard the results, she demanded that the effect remain in the song, and her original vocal be erased, much to the chagrin of her record company, who wanted it removed; upon their suggestion, Cher's response to the record label was \\\"over my dead body!\\\"[citation needed] The vocal effect is caused by a pitch correction speed that is \\\"set too fast for the audio that it is processing.\\\" \\n\\n\\nU.S. Billboard Hot 100 Airplay\\t1\\nU.S. Billboard Hot 100\\t1\\nU.S. Billboard Hot Dance Club Play\\t1\\nU.S. Billboard Hot Dance Singles Sales\\t1\\nU.S. Billboard Hot Adult Contemporary Tracks\\t2\\nU.S. Billboard Hot Adult Top 40 Tracks\\t2\\nU.S. Billboard Top 40 Mainstream\\t2\\nArgentinian Singles Chart\\t2\\nAustralian ARIA Singles Chart\\t1\\nAustrian Singles Chart\\t2\\nBelgian Singles Chart\\t1\\nBrazilian Airplay Chart\\t1\\nCroatian Singles Chart\\t1\\nCanadian Singles Chart\\t1\\nDanish Singles Chart\\t1\\nDutch Mega Top 50 Singles Chart\\t1\\nDutch Top 40\\t1\\nEuropean Singles Chart\\t1\\nFinnish Singles Chart\\t6\\nFrench Singles Chart\\t1\\nGerman Singles Chart\\t1\\nIrish Singles Chart\\t1\\nIsraeli Singles Chart\\t1\\nItalian Singles Chart\\t1\\nLatvian Singles Chart\\t1\\nMexican Singles Chart\\t1\\nNew Zealand's Singles Chart\\t1\\nNorwegian Singles Chart\\t1\\nPolish Singles Chart\\t1\\nSpanish Singles Chart\\t1\\nSwedish Singles Chart\\t1\\nSwedish Airplay Chart\\t1\\nSwiss Singles Chart\\t1\\nUK Singles Chart\\t1\\nUnited World Chart\\t1\\n\\nOfficial CHER Fan Club: https://www.cherfanclub.com <a href=\\\"http://www.last.fm/music/Cher/_/Believe\\\">Read more on Last.fm</a>. User-contributed text is available under the Creative Commons By-SA License; additional terms may apply.\"}}}"

	r := io.NopCloser(bytes.NewReader([]byte(jsonTest)))
	GetDoFunc = func(*http.Request) (*http.Response, error) {
		return &http.Response{
			StatusCode: 200,
			Body:       r,
		}, nil
	}

	resp, err := parser_discogs.Get(url)
	if err != nil {
		fmt.Println("Something went wrong with connecting to lastfm")
		log.Fatal(err)
	}

	data, err := io.ReadAll(resp.Body)
	if err != nil {
		fmt.Println("Something went wrong with reading data...")
		log.Fatal(err)
	}
	var track lastfm_structs2.OriginalLastFmTrackStruct
	json.Unmarshal(data, &track)

	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, "Believe", track.Track.Name)
}
