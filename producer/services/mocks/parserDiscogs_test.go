package mocks

import (
	"bytes"
	"encoding/json"
	"github.com/stretchr/testify/assert"
	"io"
	"log"
	"net/http"
	"producer/parsers/parser-discogs/discogs-functions"
	"producer/parsers/parser-discogs/discogs-structs"
	"testing"
)

func init() {
	discogs_functions.Client = &MockClient{}
}

func TestReadArtistById(t *testing.T) {
	url := "https://api.discogs.com/artists/170355"
	jsonTest := "{\"name\": \"Deep Purple\", \"id\": 170355, \"resource_url\": \"https://api.discogs.com/artists/170355\", \"uri\": \"https://www.discogs.com/artist/170355-Deep-Purple\", \"releases_url\": \"https://api.discogs.com/artists/170355/releases\", \"images\": [{\"type\": \"primary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 219}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 600}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 372}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 382}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 704}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 375}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 357}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 433}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 381}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 489}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 572}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 542, \"height\": 379}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 584, \"height\": 370}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 596, \"height\": 445}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 567, \"height\": 836}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 531, \"height\": 410}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 592, \"height\": 750}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 574}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 708}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 446}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 332}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 575, \"height\": 768}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 400}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 410}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 400, \"height\": 268}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 529, \"height\": 743}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 432, \"height\": 610}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 603}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 600}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 300, \"height\": 287}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 432}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 512}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 450}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 542, \"height\": 543}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 808}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 399}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 635}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 755}], \"profile\": \"Hard Rock band from England, United Kingdom.\\r\\n\\r\\nThe band formed in 1968. Along with Led Zeppelin and Black Sabbath, they are considered to be among the pioneers of heavy metal and modern hard rock, although some band members believe that their music cannot be categorised as belonging to any one genre. They were once listed by the Guinness Book of World Records as \\\"the loudest pop group\\\", and have sold over 100 million albums worldwide. Deep Purple were ranked #22 on VH1's Greatest Artists of Hard Rock programme.\\r\\n\\r\\nDeep Purple were inducted into the Rock and Roll Hall of Fame in 2016.\", \"urls\": [\"https://deeppurple.com/\", \"https://www.facebook.com/officialdeeppurple\", \"https://myspace.com/deeppurple\", \"https://www.instagram.com/deeppurple_official/\", \"https://twitter.com/_DeepPurple\", \"https://www.youtube.com/channel/UChFONkdHg3zrt3zaHmx1bKA\", \"https://www.youtube.com/user/DeepPurpleVEVO\", \"https://www.deeppurple-whoosh.com/\", \"https://www.deeppurple-infinite.com/\", \"https://deeppurple.tmstor.es/\", \"https://en.wikipedia.org/wiki/Deep_Purple\", \"https://www.thehighwaystar.com/\", \"http://deep-purple.net/\", \"https://vk.com/deep_purple\", \"https://www.deep-purple.ru/\"], \"namevariations\": [\"\\\"\\u0414\\u0438\\u043f \\u041f\\u0451\\u0440\\u043f\\u043b\\\"\", \"D. P.\", \"D. Purple\", \"Deep ?urp!e\", \"Deep ?urp!e And Friends\", \"Deep Purpl\", \"Deep Purple (Mark II)\", \"Deep Purple MK2\", \"Deep Purple.\", \"Purple\", \"The Deep Purple\", \"\\u00ab\\u0414\\u0438\\u043f \\u041f\\u044d\\u0440\\u043f\\u043b\\u00bb\", \"\\u0413\\u0440\\u0443\\u043f\\u043f\\u0430 \\\"\\u0414\\u0438\\u043f \\u041f\\u0451\\u0440\\u043f\\u043b\\\"\", \"\\u0413\\u0440\\u0443\\u043f\\u043f\\u0430 \\u00ab\\u0414\\u0438\\u043f \\u041f\\u0451\\u0440\\u043f\\u043b\\u00bb\", \"\\u0414\\u0438\\u0439\\u043f \\u041f\\u044a\\u0440\\u043f\\u044a\\u043b\", \"\\u0414\\u0438\\u043f \\u041f\\u0435\\u0440\\u043f\\u043b\", \"\\u0414\\u0438\\u043f \\u041f\\u044d\\u0440\\u043f\\u043b\", \"\\u0414\\u0438\\u043f \\u041f\\u0451\\u043f\\u043b\", \"\\u0414\\u0438\\u043f \\u041f\\u0451\\u0440\\u043f\\u043b\", \"\\u0414\\u0438\\u043f\\u043f\\u0430\\u043f\\u043b\", \"\\u30c7\\u30a3\\u30fc\\u30d7\\u30fb\\u30d1\\u30fc\\u30d7\\u30eb\", \"\\u30c7\\u30a3\\u30fc\\u30d7\\u30fb\\u30d1\\u30fc\\u30d7\\u30eb = Deep Purple\", \"\\u6df1\\u7d2b\\u4e50\\u961f\", \"\\u6df1\\u7d2b\\u8272\\u4e50\\u961f\"], \"members\": [{\"id\": 76588, \"name\": \"Joe Satriani\", \"resource_url\": \"https://api.discogs.com/artists/76588\", \"active\": false}, {\"id\": 94844, \"name\": \"Steve Morse\", \"resource_url\": \"https://api.discogs.com/artists/94844\", \"active\": false}, {\"id\": 123906, \"name\": \"Roger Glover\", \"resource_url\": \"https://api.discogs.com/artists/123906\", \"active\": true}, {\"id\": 261635, \"name\": \"Ian Paice\", \"resource_url\": \"https://api.discogs.com/artists/261635\", \"active\": true}, {\"id\": 262410, \"name\": \"Jon Lord\", \"resource_url\": \"https://api.discogs.com/artists/262410\", \"active\": false}, {\"id\": 267270, \"name\": \"Glenn Hughes\", \"resource_url\": \"https://api.discogs.com/artists/267270\", \"active\": false}, {\"id\": 309402, \"name\": \"Ritchie Blackmore\", \"resource_url\": \"https://api.discogs.com/artists/309402\", \"active\": false}, {\"id\": 312317, \"name\": \"Tommy Bolin\", \"resource_url\": \"https://api.discogs.com/artists/312317\", \"active\": false}, {\"id\": 321792, \"name\": \"Don Airey\", \"resource_url\": \"https://api.discogs.com/artists/321792\", \"active\": true}, {\"id\": 349634, \"name\": \"Ian Gillan\", \"resource_url\": \"https://api.discogs.com/artists/349634\", \"active\": true}, {\"id\": 369909, \"name\": \"David Coverdale\", \"resource_url\": \"https://api.discogs.com/artists/369909\", \"active\": false}, {\"id\": 517994, \"name\": \"Nick Simper\", \"resource_url\": \"https://api.discogs.com/artists/517994\", \"active\": false}, {\"id\": 517995, \"name\": \"Rod Evans\", \"resource_url\": \"https://api.discogs.com/artists/517995\", \"active\": false}, {\"id\": 1883737, \"name\": \"Simon McBride\", \"resource_url\": \"https://api.discogs.com/artists/1883737\", \"active\": true}, {\"id\": 4350901, \"name\": \"Joseph Arthur Linquito\", \"resource_url\": \"https://api.discogs.com/artists/4350901\", \"active\": false}], \"data_quality\": \"Needs Vote\"}"

	r := io.NopCloser(bytes.NewReader([]byte(jsonTest)))
	GetDoFunc = func(*http.Request) (*http.Response, error) {
		return &http.Response{
			StatusCode: 200,
			Body:       r,
		}, nil
	}

	resp, err := discogs_functions.Get(url)
	if err != nil {
		log.Fatal(err)
	}
	defer resp.Body.Close()

	var artist discogs_structs.DiscogsArtistJson
	if resp.StatusCode == http.StatusOK {
		bodyBytes, err := io.ReadAll(resp.Body)
		if err != nil {
			log.Fatal(err)
		}
		json.Unmarshal(bodyBytes, &artist)
	}

	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, 170355, artist.ID)
	assert.EqualValues(t, "Deep Purple", artist.Name)
}

func TestReadAlbumById(t *testing.T) {
	url := "https://api.discogs.com/releases/249504"
	jsonTest := "{\"id\": 249504, \"status\": \"Accepted\", \"year\": 1987, \"resource_url\": \"https://api.discogs.com/releases/249504\", \"uri\": \"https://www.discogs.com/release/249504-Rick-Astley-Never-Gonna-Give-You-Up\", \"artists\": [{\"name\": \"Rick Astley\", \"anv\": \"\", \"join\": \"\", \"role\": \"\", \"tracks\": \"\", \"id\": 72872, \"resource_url\": \"https://api.discogs.com/artists/72872\"}], \"artists_sort\": \"Rick Astley\", \"labels\": [{\"name\": \"RCA\", \"catno\": \"PB 41447\", \"entity_type\": \"1\", \"entity_type_name\": \"Label\", \"id\": 895, \"resource_url\": \"https://api.discogs.com/labels/895\"}], \"series\": [], \"companies\": [{\"name\": \"BMG Records (UK) Ltd.\", \"catno\": \"\", \"entity_type\": \"13\", \"entity_type_name\": \"Phonographic Copyright (p)\", \"id\": 82835, \"resource_url\": \"https://api.discogs.com/labels/82835\"}, {\"name\": \"BMG Records (UK) Ltd.\", \"catno\": \"\", \"entity_type\": \"14\", \"entity_type_name\": \"Copyright (c)\", \"id\": 82835, \"resource_url\": \"https://api.discogs.com/labels/82835\"}, {\"name\": \"Pete Waterman Ltd.\", \"catno\": \"\", \"entity_type\": \"13\", \"entity_type_name\": \"Phonographic Copyright (p)\", \"id\": 301937, \"resource_url\": \"https://api.discogs.com/labels/301937\"}, {\"name\": \"All Boys Music Ltd.\", \"catno\": \"\", \"entity_type\": \"21\", \"entity_type_name\": \"Published By\", \"id\": 273945, \"resource_url\": \"https://api.discogs.com/labels/273945\"}, {\"name\": \"BMG Records\", \"catno\": \"\", \"entity_type\": \"9\", \"entity_type_name\": \"Distributed By\", \"id\": 26385, \"resource_url\": \"https://api.discogs.com/labels/26385\"}, {\"name\": \"BMG Ariola\", \"catno\": \"\", \"entity_type\": \"9\", \"entity_type_name\": \"Distributed By\", \"id\": 33652, \"resource_url\": \"https://api.discogs.com/labels/33652\"}, {\"name\": \"RCA Records\", \"catno\": \"\", \"entity_type\": \"8\", \"entity_type_name\": \"Marketed By\", \"id\": 29656, \"resource_url\": \"https://api.discogs.com/labels/29656\"}, {\"name\": \"Utopia Studios\", \"catno\": \"\", \"entity_type\": \"30\", \"entity_type_name\": \"Lacquer Cut At\", \"id\": 266218, \"resource_url\": \"https://api.discogs.com/labels/266218\"}, {\"name\": \"BMG Records (UK) Ltd.\", \"catno\": \"\", \"entity_type\": \"5\", \"entity_type_name\": \"Licensed To\", \"id\": 82835, \"resource_url\": \"https://api.discogs.com/labels/82835\"}, {\"name\": \"PWL\", \"catno\": \"\", \"entity_type\": \"4\", \"entity_type_name\": \"Record Company\", \"id\": 30024, \"resource_url\": \"https://api.discogs.com/labels/30024\"}, {\"name\": \"CBS Pressing Plant, Aston Clinton\", \"catno\": \"\", \"entity_type\": \"17\", \"entity_type_name\": \"Pressed By\", \"id\": 553982, \"resource_url\": \"https://api.discogs.com/labels/553982\"}], \"formats\": [{\"name\": \"Vinyl\", \"qty\": \"1\", \"descriptions\": [\"7\\\"\", \"45 RPM\", \"Single\", \"Stereo\"]}], \"data_quality\": \"Needs Vote\", \"community\": {\"have\": 2720, \"want\": 461, \"rating\": {\"count\": 177, \"average\": 3.69}, \"submitter\": {\"username\": \"memory\", \"resource_url\": \"https://api.discogs.com/users/memory\"}, \"contributors\": [{\"username\": \"memory\", \"resource_url\": \"https://api.discogs.com/users/memory\"}, {\"username\": \"vargind\", \"resource_url\": \"https://api.discogs.com/users/vargind\"}, {\"username\": \"alistairk\", \"resource_url\": \"https://api.discogs.com/users/alistairk\"}, {\"username\": \"hog\", \"resource_url\": \"https://api.discogs.com/users/hog\"}, {\"username\": \"rwrackham\", \"resource_url\": \"https://api.discogs.com/users/rwrackham\"}, {\"username\": \"jan_marian\", \"resource_url\": \"https://api.discogs.com/users/jan_marian\"}, {\"username\": \"_80_\", \"resource_url\": \"https://api.discogs.com/users/_80_\"}, {\"username\": \"chillyboy64\", \"resource_url\": \"https://api.discogs.com/users/chillyboy64\"}, {\"username\": \"strummin\", \"resource_url\": \"https://api.discogs.com/users/strummin\"}, {\"username\": \"djcarbines\", \"resource_url\": \"https://api.discogs.com/users/djcarbines\"}, {\"username\": \"Skinheadmate\", \"resource_url\": \"https://api.discogs.com/users/Skinheadmate\"}, {\"username\": \"Stathisan\", \"resource_url\": \"https://api.discogs.com/users/Stathisan\"}, {\"username\": \"djtarzanboy\", \"resource_url\": \"https://api.discogs.com/users/djtarzanboy\"}, {\"username\": \"anagrama\", \"resource_url\": \"https://api.discogs.com/users/anagrama\"}], \"data_quality\": \"Needs Vote\", \"status\": \"Accepted\"}, \"format_quantity\": 1, \"date_added\": \"2004-04-30T08:10:05-07:00\", \"date_changed\": \"2022-08-03T03:03:28-07:00\", \"num_for_sale\": 78, \"lowest_price\": 0.52, \"master_id\": 96559, \"master_url\": \"https://api.discogs.com/masters/96559\", \"title\": \"Never Gonna Give You Up\", \"country\": \"UK\", \"released\": \"1987-07-00\", \"notes\": \"UK Release has a black label with the text \\\"Manufactured In England\\\" printed on it.\\n\\nSleeve:\\n\\u2117 1987 \\u2022 BMG Records (UK) Ltd. \\u00a9 1987 \\u2022 BMG Records (UK) Ltd.\\nDistributed in the UK by BMG Records \\u2022  Distribu\\u00e9 en Europe par BMG/Ariola \\u2022 Vertrieb en Europa d\\u00fcrch BMG/Ariola.\\n\\nCenter labels:\\n\\u2117 1987 Pete Waterman Ltd.\\nOriginal Sound Recording made by PWL.\\nBMG Records (UK) Ltd. are the exclusive licensees for the world.\\n\\nDurations do not appear on the release.\\n\\nRunouts are etched, except 'B' stamp in variant '3. 'MS' is encircled. \", \"released_formatted\": \"Jul 1987\", \"identifiers\": [{\"type\": \"Barcode\", \"value\": \"5012394144777\"}, {\"type\": \"Label Code\", \"value\": \"LC 0316\"}, {\"type\": \"Price Code\", \"value\": \"AC\", \"description\": \"D:\"}, {\"type\": \"Price Code\", \"value\": \"RC110\", \"description\": \"F:\"}, {\"type\": \"Price Code\", \"value\": \"AA\", \"description\": \"UK:\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447 A\\u2021\", \"description\": \"A side label\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447 B\\u2021\", \"description\": \"B side label\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447 A2 UTOPIA MS\", \"description\": \"A side runout, variant 1\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447-B.2 UTOPIA MS\", \"description\": \"B side runout, variant 1\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447 A4 UTOPIA MS.\", \"description\": \"A side runout, variant 2\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447 B4 UTOPIA MS \\u2665 RD.\", \"description\": \"B side runout, variant 2\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447 A2 UTOPIA MS B\", \"description\": \"A side runout, variant 3\"}, {\"type\": \"Matrix / Runout\", \"value\": \"PB 41447-B.2 B UTOPIA MS\", \"description\": \"B side runout, variant 3\"}], \"videos\": [{\"uri\": \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\", \"title\": \"Rick Astley - Never Gonna Give You Up (Official Music Video)\", \"description\": \"The official video for \\u201cNever Gonna Give You Up\\u201d by Rick Astley\\n \\n\\u201cNever Gonna Give You Up\\u201d was a global smash on its release in July 1987, topping the charts in 25 countries including Rick\\u2019s native UK and the US Billboard Hot 100.  It also won \", \"duration\": 213, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=5HJOCSUIMh8\", \"title\": \"Rick Astley - Never Gonna Give You (Cake Mix) [12'' maxi single]\", \"description\": \"Rick Astley \\u2013 Never Gonna Give You Up\\n\\nSello: RCA \\u2013 PT-41448\\nFormato: Vinilo, 12, 45 RPM, Maxi-Single\\nPa\\u00eds: Spain\\nPublicado: 1987\\n\\nA  Never Gonna Give You Up (Cake Mix) 5:48\\n\\nEngineer \\u2013 Mark McGuire, Mike Duffy\\nMixed By \\u2013 Mixmaster Pete Hammond\\nWritten-B\", \"duration\": 354, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=GHMjD0Lp5DY\", \"title\": \"Rick Astley  - Never Gonna Give You Up (Pianoforte) (Official Audio)\", \"description\": \"The official audio for Never Gonna Give You Up (Pianoforte). \\nFrom the album The Best Of Me. Buy/Listen: https://RickAstley.lnk.to/BestID\\nLimited edition formats available on Rick's store: https://RickAstley.lnk.to/storeID\\n\\nSubscribe to the official Rick \", \"duration\": 210, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=NTWSgzeBPk4\", \"title\": \"Rick Astley - Never Gonna Give You Up (Cake Mix) (1987)\", \"description\": \"Reissued due to poorer quality previous video.\", \"duration\": 349, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=EtXFdvQxbxA\", \"title\": \"Rick Astley - Never Gonna Give You Up (Instrumental) [12'' maxi single]\", \"description\": \"Rick Astley \\u2013 Never Gonna Give You Up\\n\\nSello: RCA \\u2013 PT-41448\\nFormato: Vinilo, 12, 45 RPM, Maxi-Single\\nPa\\u00eds: Spain\\nPublicado: 1987\\n\\nB1  Never Gonna Give You Up (Instrumental) 6:21\\n\\nEngineer \\u2013 Mark McGuire, Mike Duffy\\nMixed By \\u2013 Mixmaster Pete Hammond\\nWrit\", \"duration\": 393, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=lYBUbBu4W08\", \"title\": \"Never Gonna Give You Up\", \"description\": \"Provided to YouTube by BMG Rights Management (UK) Limited\\n\\nNever Gonna Give You Up \\u00b7 Rick Astley\\n\\nWhenever You Need Somebody\\n\\n\\u2117 1987 BMG Rights Management (UK) Limited\\n\\nReleased on: 1987-11-12\\n\\nVocals: Rick Astley\\nProducer, Keyboards: Mike Stock\\nGuitar\", \"duration\": 214, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=OTUAMVVzYug\", \"title\": \"Rick Astley - Never Gonna Give You Up [12'' maxi single]\", \"description\": \"Rick Astley \\u2013 Never Gonna Give You Up\\n\\nSello: RCA \\u2013 PT-41448\\nFormato: Vinilo, 12, 45 RPM, Maxi-Single\\nPa\\u00eds: Spain\\nPublicado: 1987\\n\\nB2  Never Gonna Give You Up 3:32\\n\\nEngineer \\u2013 Mark McGuire, Mike Duffy\\nMixed By \\u2013 Mixmaster Pete Hammond\\nWritten-By, Produce\", \"duration\": 213, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=jP8TW6X-Apo\", \"title\": \"Never Gonna Give You Up (Cake Mix) - Rick Astley\", \"description\": \"From the maxi single Never Gonna Give You Up (1987)\", \"duration\": 350, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=NOFlBeINOdQ\", \"title\": \"Never Gonna Give You Up (Instrumental) - Rick Astley\", \"description\": \"From the maxi single Never Gonna Give You Up (1987)\", \"duration\": 379, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=H1wVgWNpRJE\", \"title\": \"Never Gonna Give You Up (Album Version) - Rick Astley\", \"description\": \"From the maxi single Never Gonna Give You Up (1987)\", \"duration\": 214, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=_cf3fxUDZvM\", \"title\": \"Never Gonna Give You Up (Escape To New York Mix) - Rick Astley\", \"description\": \"From the maxi single Never Gonna Give You Up (1987)\", \"duration\": 423, \"embed\": true}, {\"uri\": \"https://www.youtube.com/watch?v=SjlIuoMFPww\", \"title\": \"Never Gonna Give You Up (Escape From Newton Mix) - Rick Astley\", \"description\": \"From the maxi single Never Gonna Give You Up (1987)\", \"duration\": 387, \"embed\": true}], \"genres\": [\"Electronic\", \"Pop\"], \"styles\": [\"Euro-Disco\"], \"tracklist\": [{\"position\": \"A\", \"type_\": \"track\", \"title\": \"Never Gonna Give You Up\", \"duration\": \"3:32\"}, {\"position\": \"B\", \"type_\": \"track\", \"title\": \"Never Gonna Give You Up (Instrumental)\", \"duration\": \"3:30\"}], \"extraartists\": [{\"name\": \"Me Company\", \"anv\": \"Me Co\", \"join\": \"\", \"role\": \"Design\", \"tracks\": \"\", \"id\": 547352, \"resource_url\": \"https://api.discogs.com/artists/547352\"}, {\"name\": \"Mark McGuire\", \"anv\": \"\", \"join\": \"\", \"role\": \"Engineer\", \"tracks\": \"\", \"id\": 78275, \"resource_url\": \"https://api.discogs.com/artists/78275\"}, {\"name\": \"Mike Duffy\", \"anv\": \"\", \"join\": \"\", \"role\": \"Engineer\", \"tracks\": \"\", \"id\": 95941, \"resource_url\": \"https://api.discogs.com/artists/95941\"}, {\"name\": \"Miles Showell\", \"anv\": \"MS\", \"join\": \"\", \"role\": \"Lacquer Cut By\", \"tracks\": \"\", \"id\": 383408, \"resource_url\": \"https://api.discogs.com/artists/383408\"}, {\"name\": \"Pete Hammond\", \"anv\": \"Mixmaster Pete Hammond\", \"join\": \"\", \"role\": \"Mixed By\", \"tracks\": \"\", \"id\": 34067, \"resource_url\": \"https://api.discogs.com/artists/34067\"}, {\"name\": \"Stock, Aitken & Waterman\", \"anv\": \"Stock / Aitken / Waterman\", \"join\": \"\", \"role\": \"Producer, Written-By\", \"tracks\": \"\", \"id\": 20942, \"resource_url\": \"https://api.discogs.com/artists/20942\"}], \"images\": [{\"type\": \"primary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 600}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 600}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 600}, {\"type\": \"secondary\", \"uri\": \"\", \"resource_url\": \"\", \"uri150\": \"\", \"width\": 600, \"height\": 600}], \"thumb\": \"\", \"estimated_weight\": 60, \"blocked_from_sale\": false}"

	r := io.NopCloser(bytes.NewReader([]byte(jsonTest)))
	GetDoFunc = func(*http.Request) (*http.Response, error) {
		return &http.Response{
			StatusCode: 200,
			Body:       r,
		}, nil
	}

	resp, err := discogs_functions.Get(url)
	if err != nil {
		log.Fatal(err)
	}
	defer resp.Body.Close()

	var album discogs_structs.DiscogsAlbumJson
	if resp.StatusCode == http.StatusOK {
		bodyBytes, err := io.ReadAll(resp.Body)
		if err != nil {
			log.Fatal(err)
		}
		json.Unmarshal(bodyBytes, &album)
	}

	assert.NotNil(t, resp)
	assert.Nil(t, err)
	assert.EqualValues(t, 249504, album.ID)
	assert.EqualValues(t, "Never Gonna Give You Up", album.Title)
}
